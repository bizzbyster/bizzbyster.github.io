var TripitMap=(function(c){var b=google.maps,d=b.event,a={currentInfoWindow:null,launchGoogleMap:function(f,k,l,i,g,n,h){var j=c("#"+f),m,e;if(!g){g={}}if(!j.data("has_map")&&k!==undefined&&l!==undefined){m=new b.LatLng(k,l);g.center=m;if(!g.mapTypeControlOptions){g.mapTypeControlOptions={mapTypeIds:[b.MapTypeId.ROADMAP,b.MapTypeId.SATELLITE,b.MapTypeId.HYBRID]}}if(!g.mapTypeId){g.mapTypeId=b.MapTypeId.ROADMAP}if(!g.zoom){g.zoom=13}if(!g.zoomControlOptions){g.zoomControlOptions={style:b.ZoomControlStyle.SMALL}}e=new b.Map(j.get(0),g);if(i){a.createMarker(e,k,l);d.addListenerOnce(e,"bounds_changed",function(){d.trigger(e,"resize");e.setCenter(m)})}if(n&&typeof n==="function"){d.addListenerOnce(e,"bounds_changed",function(){n.apply(null,h)})}j.data("has_map",true)}return e},launchGoogleDirections:function(o,t,C,z,q,B,i,k){var s=c("#trip_item_"+o),j=c("#mapDirections_"+o),w=c("#textDirections_"+o),h=s.find(".directions_container"),f=s.find(".trip_item_time").attr("data-ts"),y,v=t[0],n=t[1],x=t[2],u=C[0],m=C[1],l=C[2],A,e={K:b.UnitSystem.METRIC,M:b.UnitSystem.IMPERIAL},p,g,r=function(F,E,D){return(F&&E)?F+" "+E:decodeURIComponent(D)};if(f){y=f*1000}if(!B){B={}}if(!s.data("has_directions")&&v&&n&&u&&m){B.mapTypeControlOptions={mapTypeIds:[b.MapTypeId.ROADMAP,b.MapTypeId.SATELLITE,b.MapTypeId.HYBRID]};B.mapTypeId=b.MapTypeId.ROADMAP;B.zoom=13;B.zoomControlOptions={style:b.ZoomControlStyle.SMALL};A=new b.Map(j.get(0),B);p=new b.DirectionsService();g={destination:r(u,m,l),origin:r(v,n,x),provideRouteAlternatives:true,travelMode:z};if(q){g.unitSystem=e[q]}if(g.travelMode==b.TravelMode.TRANSIT&&y){g.transitOptions={departureTime:new Date(y)}}p.route(g,function(D,E){var I,G,F,H;if(E!==b.DirectionsStatus.OK){F=decodeURIComponent(h.data("from-location"));H=decodeURIComponent(h.data("to-location"));j.remove();h.addClass("indent").html('<div class="dubMrg fntL">We could not calculate directions between '+F+" and "+H+'.</div><div class="clr"></div>')}else{I={directions:D,map:A,panel:w.get(0)};d.addListenerOnce(A,"bounds_changed",function(){d.trigger(A,"resize");if(i&&typeof i==="function"){i.apply(null,k)}});G=new b.DirectionsRenderer(I)}});s.data("has_directions",true)}},createMarker:function(k,j,h,i,l){var e=new b.LatLng(j,h),g={map:k,position:e},f;if(i){g.icon=i}f=new b.Marker(g);if(l){a["marker_"+l]=f}return f},openLabeledMarker:function(e){window.setTimeout(function(){d.trigger(e,"click",{shouldZoom:true})},750)},createLabeledMarker:function(f,n,p,l,o,r,q,j,m,k,i,h){var e={labelAnchor:new b.Point(r,q),labelContent:l,labelClass:o,map:f,position:p},g;if(m){e.icon=new b.MarkerImage(m,new b.Size(k,i),new b.Point(0,0),new b.Point(h,i))}g=new MarkerWithLabel(e);if(n){a["marker_"+n]=g}d.addListener(g,"click",function(u){var s=g.getPosition(),x={content:j,maxWidth:350,position:s},v=new b.InfoWindow(x),w=f.getZoom(),t=a.markerClusterer.getMaxZoom();if(a.currentInfoWindow){a.currentInfoWindow.close()}if(u&&u.shouldZoom&&w<=t){f.setCenter(s);f.setZoom(t+1)}v.open(f);a.currentInfoWindow=v});return g},initializeMarkerClustererOnMap:function(j,g){var h=[53,56,66,78,90],k=[],e,f;for(f=1;f<=5;++f){k.push({url:"/images/maps/cluster"+f+".png",height:h[f-1],width:h[f-1],textColor:"white"})}e={gridSize:30,maxZoom:6,styles:k};a[g]=j;a.markerClusterer=new MarkerClusterer(j,null,e);return a.markerClusterer},labelMap:function(f,g){var e={minZoom:1,zoom:2,zoomControlOptions:{position:b.ControlPosition.TOP_LEFT,size:b.ZoomControlStyle.SMALL}};a.markerClusterer.addMarkers(g);f.setOptions(e);if(g.length>0){a.fitMapToMarkers(f,g)}},fitMapToMarkers:function(g,j){var f=new b.LatLngBounds(),e,h;if(!c.isArray(j)){j=c.map(j,function(i){return i})}h=j.length;if(h>1){for(e in j){if(j.hasOwnProperty(e)){f.extend(j[e].getPosition())}}g.fitBounds(f)}else{if(h==1){g.setCenter(j[0].getPosition());g.setZoom(8)}}},assertZoomedToAtLeast:function(g,f,e){if(g.getZoom()<f){g.setZoom(f);if(e){g.panTo(e)}}},constructMarkerImageUsingSprite:function(o,j,g,m,l,f){var n=new b.Size(j,g),h=j/2,e=f?g/2:g,i=new b.Point(h,e),k=new b.Point(m,l);return new b.MarkerImage(o,n,k,i)},initMapOnTripItemElement:function(e,j,f){var i=e.find(".map_container"),h=i.find(".map_element"),g={scrollwheel:i.data("should-allow-scrollwheel")?true:false};window.setTimeout(function(){a.launchGoogleMap(h.attr("id"),i.data("latitude"),i.data("longitude"),true,g,j,f)},i.data("timeout"))},initDirectionsOnTripItemElement:function(f,l,g){var j=f.find(".directions_container"),h={scrollwheel:j.data("should-allow-scrollwheel")?true:false},i=[j.data("from-latitude"),j.data("from-longitude"),j.data("from-location")],k=[j.data("to-latitude"),j.data("to-longitude"),j.data("to-location")],e=google.maps.TravelMode[j.data("travel-mode")];window.setTimeout(function(){a.launchGoogleDirections(f.data("trip-item-id"),i,k,e,j.data("unit-system"),h,l,g)},j.data("timeout"))}};return a}(jQuery));