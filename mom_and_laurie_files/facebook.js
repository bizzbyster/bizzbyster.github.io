(function(a){window.TRIPIT.social.Facebook=function(){var c=this,b=false,d=false;c.load=function(e){a("<div>").attr("id","fb-root").appendTo(document.body);a.getScript("//connect.facebook.net/en_US/sdk.js").done(function(){if(typeof FB==="object"){FB.init({appId:it.fbApiKey,cookie:true,display:"popup",version:"v2.1",xfbml:true});FB.getLoginStatus(function(f){if(f.authResponse){d=true}else{d=false}});b=true;if(a.isFunction(e)){e()}}})};c.isLoaded=function(){return b};c.isLoggedIn=function(){return d};c.hasPermission=function(e,g,f){if(typeof FB==="object"){FB.api("/me?fields=permissions",function(h){var i=h&&h.permissions&&h.permissions.data&&h.permissions.data[0]&&h.permissions.data[0][e];if(i){if(a.isFunction(g)){console.log("success");g()}}else{if(a.isFunction(f)){console.log("failure");console.log(h);f()}}})}}};window.TRIPIT.social.Facebook.ShareButton=function(e,d){var b=this,c=a(e);b.link=c.data("link");c.click({shareButton:b},b.showDialog);b.onOpen=a.noop;a.extend(b,d)};window.TRIPIT.social.Facebook.ShareButton.prototype=a.extend(true,window.TRIPIT.social.Facebook.ShareButton.prototype,{update:function(b){a.extend(true,this,b)},showDialog:function(c){c.preventDefault();var b=c.data.shareButton;if(a.isFunction(b.onOpen)){b.onOpen({event:c})}if(typeof FB==="object"){FB.ui({method:"share",href:b.link},function(d){var e=d&&d.post_id;if(e){b.onShareSuccess(d)}else{b.onShareFailure(d)}})}},onShareSuccess:function(b){a(document).trigger("shareFacebook",{shareButton:this})},onShareFailure:function(b){}})}(jQuery));